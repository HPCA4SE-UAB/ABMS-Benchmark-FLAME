#!/bin/sh
#echo "Get results from execution"

if [ "$#" -ne 1 ]; then
  echo "Usage: $0 num_executions" >&2
  exit 1
fi

printf 'execution total_time main_time compute_time cooperate_time total_bytes c total agents \n';
for a in $(seq 1 $1);
do
        total_time=$(grep "Execution time" output/sortida${a}.txt | awk '{print $4}' | awk -F ":" '{printf "%d", ($1*60*1000+$2*1000+$3)}' );
        main_time=$(grep mean -A 20 output/pprof_out$a | grep main | awk '{print $3}');
        compute_time=$(grep mean -A 20 output/pprof_out$a | grep compute | awk '{print $3}');
        cooperate_time=$(grep mean -A 20 output/pprof_out$a | grep cooperate | awk '{print $3}');
        total_byte=$(grep "Message size received from all nodes"  output/pprof_out$a | awk '{s+=($1*$4)} END {printf "%d", s}');
	c=$(grep "c" output/validation_check_out$a | awk '{print $2}');
	total=$(grep "total" output/validation_check_out$a | awk '{print $2}');
	n=$(grep "agents" output/validation_check_out$a | awk '{print $2}');
        printf '%d %s %s %s %s %s %s %s %s\n' $a $total_time $main_time $compute_time $cooperate_time $total_byte $c $total $n;
done
